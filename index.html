<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TexConversor - de PDF para DOCX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 600px;
        }
        .upload-area {
            border-style: dashed;
            border-color: #d1d5db;
            background-color: #fafafa;
            transition: all 0.3s ease;
        }
        .upload-area.drag-over {
            background-color: #e5e7eb;
            border-color: #9ca3af;
        }
        .loading-bar {
            background-color: #10b981;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

<div class="container bg-white shadow-xl rounded-2xl p-8 space-y-6 text-center">
    <h1 class="text-3xl font-bold text-gray-800">TexConversor de PDF para DOCX</h1>
    <p class="text-gray-500">
        Selecione um arquivo PDF para convertê-lo em um documento Word (.docx) editável.
    </p>

    <!-- Área de Upload -->
    <div id="drop-area" class="upload-area flex flex-col items-center justify-center p-10 rounded-xl cursor-pointer">
        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-4-4v0a4 4 0 014-4h4l1-1h5.828a2 2 0 011.414.586L19 9l-1 1v7a2 2 0 01-2 2H7z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11l-3-3m0 0L9 11m3-3v7"></path>
        </svg>
        <p class="mt-2 text-gray-600">Arraste e solte o arquivo aqui, ou <span class="text-indigo-500 font-medium">clique para selecionar</span></p>
        <input type="file" id="file-input" accept=".pdf" class="hidden">
    </div>

    <!-- Mensagens de Status -->
    <div id="status-message" class="text-gray-600 font-medium hidden"></div>

    <!-- Barra de Progresso -->
    <div id="progress-container" class="w-full bg-gray-200 rounded-full h-2.5 hidden">
        <div id="progress-bar" class="loading-bar h-2.5 rounded-full" style="width: 0%;"></div>
    </div>

    <!-- Mensagem de Erro/Sucesso -->
    <div id="result-message" class="text-sm font-medium"></div>

    <!-- Script de manipulação -->
    <script>
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const statusMessage = document.getElementById('status-message');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const resultMessage = document.getElementById('result-message');
        
        let worker;

        // Adiciona um listener para a mensagem do worker
        const handleWorkerMessage = (e) => {
            const { progress, blob, error } = e.data;

            if (progress !== undefined) {
                progressBar.style.width = `${progress}%`;
            } else if (blob) {
                // Sucesso: cria um link para download
                const downloadUrl = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = blob.name || 'documento.docx';
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(downloadUrl);
                
                statusMessage.textContent = 'Conversão concluída! O download deve começar em breve.';
                progressBar.style.width = '100%';
                progressBar.classList.add('bg-green-500');
                progressBar.classList.remove('bg-red-500');
                showResult('Conversão bem-sucedida! O download foi iniciado.', 'success');
                resetState();

            } else if (error) {
                // Erro: exibe a mensagem de erro
                statusMessage.textContent = '';
                progressBar.style.width = '0%';
                showResult(`Ocorreu um erro: ${error}`, 'error');
                resetState();
            }
        };

        const showResult = (message, type) => {
            resultMessage.textContent = message;
            resultMessage.classList.remove('text-green-600', 'text-red-600');
            if (type === 'success') {
                resultMessage.classList.add('text-green-600');
            } else if (type === 'error') {
                resultMessage.classList.add('text-red-600');
            }
            resultMessage.classList.remove('hidden');
        };

        const resetState = () => {
            if (worker) {
                worker.terminate();
            }
            dropArea.classList.remove('pointer-events-none');
            fileInput.value = null;
        };

        const handleFile = (file) => {
            if (file && file.type === 'application/pdf') {
                statusMessage.textContent = `Enviando arquivo: ${file.name}...`;
                statusMessage.classList.remove('hidden');
                progressContainer.classList.remove('hidden');
                dropArea.classList.add('pointer-events-none'); // Desabilita novos uploads

                // Cria o Web Worker com um parâmetro para evitar cache
                const timestamp = new Date().getTime();
                const workerURL = new URL('converter.worker.js', window.location.href).href + `?v=${timestamp}`;
                worker = new Worker(workerURL);
                worker.onmessage = handleWorkerMessage;
                worker.postMessage(file); // Envia o arquivo para o worker
            } else {
                showResult('Por favor, selecione um arquivo PDF válido.', 'error');
            }
        };

        // Event Listeners para a área de upload
        dropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('drag-over');
        });

        dropArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropArea.classList.remove('drag-over');
        });

        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            handleFile(file);
        });
    </script>
</div>

</body>
</html>
